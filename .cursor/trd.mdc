## 기술 요구 사항 (Technical Requirement Document)

### 아키텍처 개요

- Electron 기반 멀티 플랫폼 데스크톱 앱
- 프론트엔드: React + TypeScript
- 상태 관리: TanStack Query(서버 데이터) + Zustand(로컬 UI 상태)
- 렌더링 엔진: Mermaid.js 최신 안정 버전
- 코드 에디터: Monaco Editor
- 백엔드 연동: Node.js 프로세스 내 REST/IPC 브리지, LLM API 연계

### 모듈 구성

1. **Main Process**
   - 앱 라이프사이클 관리
   - IPC 라우팅 및 보안 필터링
   - 설정 파일 입출력, 업데이트 관리
2. **Renderer Process**
   - UI 레이아웃 (Preview, Code Editor, Prompt)
   - 상태 관리 및 데이터 흐름
   - Mermaid 렌더링 캔버스
3. **Service Layer**
   - 프롬프트 → 코드 변환 서비스(LLM 어댑터)
   - Mermaid 구문 검사 서비스
   - 히스토리/버전 스토리지 (IndexedDB 또는 SQLite)

### 데이터 흐름

1. 사용자가 코드/프롬프트 입력 → Zustand 액션으로 상태 업데이트
2. TanStack Query가 서버/LLM 호출 결과 캐싱
3. Mermaid 검증 서비스가 결과 반환 → 성공 시 프리뷰 갱신, 실패 시 오류 상태 저장
4. 히스토리 모듈이 성공 렌더링 시점마다 스냅샷 저장

### 파일 구조 (초안)

```
/
├─ main/               # Electron main 프로세스
├─ renderer/
│  ├─ components/
│  ├─ hooks/
│  ├─ stores/
│  ├─ services/
│  └─ pages/
├─ shared/             # 공통 타입/유틸
├─ assets/
└─ docs/
```

### 핵심 기술 스택

- Language: TypeScript 5.x
- Framework: React 18 + Vite/Electron Builder
- Styling: TailwindCSS + React-Bootstrap 컴포넌트 래핑
- Lint/Format: ESLint, Prettier
- Testing: Vitest + React Testing Library, Playwright(E2E)
- Packaging: electron-builder

### 성능 요구

- 앱 부팅 시간 5초 이하
- Mermaid 렌더링 요청당 120ms 이하
- 프롬프트 응답(외부 API) 5초 이하, 실패 시 재시도+오프라인 큐
- 히스토리 저장 시 파일당 10MB 이하 유지

### 보안/안정성

- Content Security Policy 설정
- IPC 채널 화이트리스트, 데이터 직렬화 검증
- API 키 암호화 저장(OS Keychain)
- 자동 업데이트 시 코드 서명 적용

### DevOps

- GitHub Actions: Lint/Test/빌드 파이프라인
- Release 채널: Alpha/Beta/Stable
- Sentry/Telemetry 통합

### 오픈 이슈 및 TBD

- 로컬 LLM vs 클라우드 LLM 선택
- 다중 프로젝트 관리(탭 방식 vs 워크스페이스)
- 협업 기능 범위 및 동기화 방식

## 구현 완료 사항 (2025-11)

### 아키텍처 구현
- ✅ Electron Main Process 구성 (IPC 핸들러, 파일 시스템, 클립보드)
- ✅ Renderer Process 구현 (React 컴포넌트, 상태 관리)
- ✅ Context Bridge를 통한 안전한 IPC 통신
- ✅ Content Security Policy 설정

### 컴포넌트 구조
```
src/
├─ components/
│  ├─ MermaidPreview.tsx      # 실시간 렌더링 및 복사 기능
│  ├─ CodeEditor.tsx          # Monaco Editor 통합
│  ├─ PromptPanel.tsx         # AI 프롬프트 UI
│  ├─ ResizeHandle.tsx        # 드래그 핸들러
│  └─ ModalProvider.tsx       # 모달 상태 관리
├─ pages/
│  └─ MermaidEditor.tsx       # 메인 에디터 페이지
├─ stores/
│  └─ mermaidStore.ts         # Zustand 상태 관리
└─ type.ts                    # TypeScript 타입 정의
```

### IPC 핸들러 구현
- ✅ `mermaid:loadProjects` - 프로젝트 로드
- ✅ `mermaid:saveProject` - 프로젝트 저장
- ✅ `mermaid:processPrompt` - 프롬프트 처리 (LLM 연동 준비)
- ✅ `mermaid:saveSVGFile` - SVG 파일 저장
- ✅ `mermaid:copyToClipboard` - PNG 클립보드 복사

### 성능 최적화
- ✅ SVG 렌더링 결과 캐싱
- ✅ 마지막 유효 코드 저장으로 오류 시 빠른 복구
- ✅ 자동 저장 (1초 디바운스)
- ✅ Canvas 기반 효율적인 이미지 변환

### 보안 구현
- ✅ Content Security Policy 설정
- ✅ Context Isolation 활성화
- ✅ Node Integration 비활성화
- ✅ IPC 채널 화이트리스트

